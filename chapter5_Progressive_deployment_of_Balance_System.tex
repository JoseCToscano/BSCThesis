\chapter{Progressive deployment of Balance System}

The transition into a fully automated system, coming from a completely manual process must be done in a progressive way. Every change must be backwards compatible to ensure reliability and to avoid a possible overwhelm due to unknown behaviours. The people involved in this process, in this case the treasury team, must be able to adapt their tasks into this new hybrid system, where some of the tasks are now automated, but others still require their input.

\section{Progressive automation}

In order to progressively migrate into the automation of the credit disbursement process, additional attributes where added into the existing Store entity to be used as variables for either automating or asking for additional validation in some processes: \textit{hasBalanceSystemActive}, \textit{confirmBankTransfersAutomatically}, \textit{mockBankTransferDispatch}. As a good practice, to guarantee the correct handling, identification and manipulation of these variables, a standard naming convention was used, ensuring these attributes where mnemonic, to indicate the observer the intent of its use. \cite{oracle} Key automated actions may or may not require additional validations or confirmation before being executed, such as the dispatch of the bank transfer after it was created, or the mocking of the actual bank transfer. Furthermore, the activation of the balance system for any store also relies on one of these attributes.  This will enable the integration of the automated processes, but still rely on some further manual confirmation or validations if required.\\

\section{Deployment to production}

The process of shipping this new balance system into production consisted in 2 main steps: The deployment of the balance system for some particular stores in an inactive state, and the activation of the system for real bank transfers. Since the balance system is designed to function particularly for every store of Atrato's merchants, simply enabling the system for any store will start to execute the particular actions for each trigger in the system.\\
    
When the system is enabled for a store this means that the every trigger will start to create Balance Updates and generate Bank Transfers accordingly, nonetheless, in order to actually start sending money to from Atrato's bank account to the partners account a second validation must be made. The integration with STP and its Dispersion service can be mocked individually for any store. This means that multiple stores could have the balance system enabled, but none of them will actually send any money unless they have STP active as well. This mock enables the treasury team to start monitoring the real behaviour of the balance system without the risk of making any real bank transaction, just as if the system was in a trial period. In this way, they can ensure mainly that the commisions for any particular store and their active credits are being computed appropiately. Once the correct behaviour and computations of any balance system is confirmed, then the trial period could end by simply activating STP to the system. Now, instead of simply mocking the bank transfer, a real transaction will be made. This two step deployment process will facilitate having control over wich stores' automatic balance system is enabled and also validating wich of these are working appropiately and are ready to be completely automated in production.
